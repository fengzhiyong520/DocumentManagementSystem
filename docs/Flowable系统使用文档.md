# Flowable 工作流系统使用文档

## 目录
- [1. 概述](#1-概述)
- [2. 流程定义管理](#2-流程定义管理)
- [3. 流程节点配置](#3-流程节点配置)
- [4. 流程部署](#4-流程部署)
- [5. 审批流程使用](#5-审批流程使用)
- [6. 审批管理](#6-审批管理)
- [7. 流程历史查询](#7-流程历史查询)
- [8. 流程监控](#8-流程监控)
- [9. 常见问题](#9-常见问题)

---

## 1. 概述

本文档介绍如何使用文档管理系统中的 Flowable 工作流功能，包括流程定义、节点配置、审批处理等操作。

### 1.1 功能模块

- **流程配置管理**: 创建和管理审批流程定义
- **流程节点配置**: 配置审批节点和审批人
- **流程部署**: 将流程定义部署到工作流引擎
- **审批管理**: 处理待办审批任务
- **流程历史**: 查询已完成的流程历史
- **流程监控**: 监控运行中的流程实例

### 1.2 使用流程

```
创建流程定义 → 配置流程节点 → 部署流程 → 使用流程进行审批
```

---

## 2. 流程定义管理

### 2.1 进入流程配置管理

1. 登录系统后，在左侧菜单栏找到 **"流程配置管理"**
2. 点击进入流程定义列表页面

### 2.2 创建流程定义

1. 点击页面右上角的 **"新增"** 按钮
2. 填写流程定义信息：
   - **流程名称**: 例如 "借阅审批流程"
   - **流程Key**: 唯一标识，例如 "borrowApproval"（建议使用英文）
   - **流程描述**: 描述流程用途
   - **状态**: 启用/禁用
   - **分类**: 流程分类（可选）
3. 点击 **"确定"** 保存

**注意事项**：
- 流程Key必须唯一，不能重复
- 流程Key建议使用英文，避免特殊字符
- 创建后需要配置节点才能部署

### 2.3 编辑流程定义

1. 在流程定义列表中，找到要编辑的流程
2. 点击操作列的 **"编辑"** 按钮
3. 修改流程信息
4. 点击 **"确定"** 保存

**注意事项**：
- 已部署的流程定义修改后需要重新部署
- 如果流程正在使用中，修改可能影响现有流程实例

### 2.4 删除流程定义

1. 在流程定义列表中，找到要删除的流程
2. 点击操作列的 **"删除"** 按钮
3. 确认删除

**注意事项**：
- 删除流程定义会同时删除所有节点配置
- 如果流程已部署，建议先取消部署再删除
- 删除操作不可恢复

---

## 3. 流程节点配置

### 3.1 进入节点配置

1. 在流程定义列表中，找到要配置节点的流程
2. 点击操作列的 **"配置节点"** 按钮
3. 打开节点配置弹窗

### 3.2 添加节点

1. 点击 **"添加节点"** 按钮
2. 填写节点信息：
   - **节点ID**: 节点唯一标识，例如 "task1"（建议使用英文）
   - **节点名称**: 节点显示名称，例如 "部门经理审批"
   - **节点类型**: 选择节点类型
     - `startEvent`: 开始事件（流程开始）
     - `userTask`: 用户任务（审批节点）
     - `endEvent`: 结束事件（流程结束）
   - **排序**: 节点执行顺序（数字越小越先执行）
   - **审批人**: 直接指定审批人（用户ID，多个用逗号分隔）
   - **候选审批人**: 候选审批人（用户ID，多个用逗号分隔）
   - **候选审批组**: 候选审批组（角色ID，多个用逗号分隔）
   - **节点描述**: 节点描述（可选）
3. 点击 **"确定"** 保存节点

**节点类型说明**：
- **开始事件**: 每个流程必须有一个开始事件，通常排序为 0
- **用户任务**: 审批节点，需要配置审批人
- **结束事件**: 每个流程必须有一个结束事件，通常排序最大

**审批人配置说明**：
- **审批人（assignee）**: 直接指定审批人，优先级最高
- **候选审批人（candidateUsers）**: 多个用户都可以审批，谁先审批谁处理
- **候选审批组（candidateGroups）**: 指定角色，该角色的所有用户都可以审批

**优先级**: 审批人 > 候选审批人 > 候选审批组

### 3.3 节点配置示例

#### 示例1：单级审批

| 节点ID | 节点名称 | 节点类型 | 排序 | 审批人 |
|--------|----------|----------|------|--------|
| startEvent | 开始 | startEvent | 0 | - |
| task1 | 部门经理审批 | userTask | 1 | 1 |
| endEvent | 结束 | endEvent | 2 | - |

#### 示例2：多级审批

| 节点ID | 节点名称 | 节点类型 | 排序 | 审批人 |
|--------|----------|----------|------|--------|
| startEvent | 开始 | startEvent | 0 | - |
| task1 | 部门经理审批 | userTask | 1 | 1 |
| task2 | 总经理审批 | userTask | 2 | 2 |
| endEvent | 结束 | endEvent | 3 | - |

#### 示例3：使用候选审批人

| 节点ID | 节点名称 | 节点类型 | 排序 | 候选审批人 |
|--------|----------|----------|------|------------|
| startEvent | 开始 | startEvent | 0 | - |
| task1 | 部门经理审批 | userTask | 1 | 1,2,3 |
| endEvent | 结束 | endEvent | 2 | - |

### 3.4 编辑节点

1. 在节点列表中，找到要编辑的节点
2. 修改节点信息
3. 点击 **"确定"** 保存

### 3.5 删除节点

1. 在节点列表中，找到要删除的节点
2. 点击节点行的 **"删除"** 按钮
3. 确认删除

**注意事项**：
- 不能删除开始事件和结束事件
- 删除节点后需要重新部署流程

### 3.6 保存节点配置

1. 配置完所有节点后，点击 **"保存"** 按钮
2. 系统会保存所有节点配置
3. 保存成功后可以关闭弹窗

---

## 4. 流程部署

### 4.1 部署流程

1. 在流程定义列表中，找到要部署的流程
2. 确保流程已配置节点（至少包含开始事件、一个用户任务、结束事件）
3. 点击操作列的 **"部署"** 按钮
4. 系统会自动：
   - 生成 BPMN XML
   - 部署到 Flowable 引擎
   - 更新流程定义的部署信息

### 4.2 部署状态

- **未部署**: 流程定义未部署，不能使用
- **已部署**: 流程定义已部署，可以使用

### 4.3 重新部署

如果修改了流程定义或节点配置，需要重新部署：

1. 修改流程定义或节点配置
2. 点击 **"部署"** 按钮
3. 系统会创建新版本的流程定义

**注意事项**：
- 重新部署不会影响正在运行的流程实例
- 新启动的流程实例会使用最新版本的流程定义

---

## 5. 审批流程使用

### 5.1 申请审批（大厅管理）

1. 进入 **"大厅管理"** 页面
2. 浏览公开资料列表
3. 找到要申请查看的资料
4. 点击 **"申请查看"** 按钮
5. 填写申请信息：
   - **选择审批流程**: 从下拉列表选择已部署的审批流程
   - **申请理由**: 填写申请理由（可选）
6. 点击 **"确定"** 提交申请

**系统处理流程**：
1. 创建借阅申请记录
2. 启动选定的审批流程实例
3. 将任务分配给第一个审批节点指定的审批人
4. 申请状态变为 "审批中"

### 5.2 审批状态说明

| 状态 | 说明 |
|------|------|
| 0 - 待审批 | 申请已提交，等待审批 |
| 1 - 审批通过 | 所有审批节点都通过 |
| 2 - 审批拒绝 | 任一审批节点拒绝 |
| 3 - 已归还 | 资料已归还 |

---

## 6. 审批管理

### 6.1 查看待办任务

1. 登录系统后，进入 **"审批管理"** 页面（如果有该菜单）
2. 系统会显示当前用户的待办审批任务列表
3. 任务列表包含：
   - 申请信息（申请人、资料名称等）
   - 当前审批节点
   - 申请时间
   - 操作按钮

### 6.2 审批处理

#### 6.2.1 审批通过

1. 在待办任务列表中，找到要审批的任务
2. 点击 **"审批"** 或 **"查看详情"** 按钮
3. 查看申请详情和资料信息
4. 填写审批意见（可选）
5. 点击 **"通过"** 按钮
6. 系统会：
   - 完成当前审批任务
   - 如果还有下一节点，自动流转到下一节点
   - 如果所有节点都通过，流程结束，申请状态变为 "审批通过"

#### 6.2.2 审批拒绝

1. 在待办任务列表中，找到要审批的任务
2. 点击 **"审批"** 或 **"查看详情"** 按钮
3. 查看申请详情和资料信息
4. 填写拒绝原因（必填）
5. 点击 **"拒绝"** 按钮
6. 系统会：
   - 完成当前审批任务
   - 流程结束，申请状态变为 "审批拒绝"

### 6.3 多级审批流程

如果流程配置了多个审批节点：

1. **第一级审批**：
   - 第一个审批人审批通过后，任务自动流转到第二级
   - 第一个审批人审批拒绝后，流程结束

2. **第二级审批**：
   - 第二个审批人可以看到申请信息和第一级的审批意见
   - 第二个审批人审批通过后，如果还有下一级，继续流转
   - 如果所有级别都通过，流程结束

3. **流程结束**：
   - 所有审批节点都通过 → 申请状态变为 "审批通过"
   - 任一审批节点拒绝 → 申请状态变为 "审批拒绝"

### 6.4 候选审批人处理

如果节点配置了候选审批人（candidateUsers）或候选审批组（candidateGroups）：

1. 所有候选审批人都可以看到该任务
2. 谁先审批，任务就分配给谁
3. 其他候选审批人不能再审批该任务

---

## 7. 流程历史查询

### 7.1 查看流程历史

1. 进入 **"流程历史"** 页面（如果有该菜单）
2. 可以查看：
   - 已完成的流程实例列表
   - 每个流程实例的审批历史
   - 每个任务的审批人和审批时间

### 7.2 流程历史信息

流程历史包含：
- **流程实例ID**: 流程实例的唯一标识
- **流程定义名称**: 使用的流程定义名称
- **业务Key**: 关联的业务数据ID（如借阅申请ID）
- **开始时间**: 流程启动时间
- **结束时间**: 流程结束时间
- **状态**: 已完成/已取消
- **任务历史**: 所有任务的审批记录

### 7.3 任务历史信息

任务历史包含：
- **任务名称**: 审批节点名称
- **审批人**: 处理该任务的用户
- **审批时间**: 任务完成时间
- **审批结果**: 通过/拒绝
- **审批意见**: 审批人填写的意见

---

## 8. 流程监控

### 8.1 查看运行中的流程

1. 进入 **"流程监控"** 页面（如果有该菜单）
2. 可以查看：
   - 所有运行中的流程实例
   - 当前审批节点
   - 流程启动时间
   - 流程持续时间

### 8.2 流程实例详情

点击流程实例可以查看详情：
- **流程定义信息**: 使用的流程定义
- **当前节点**: 当前正在处理的节点
- **流程变量**: 流程中传递的变量
- **任务列表**: 当前待办任务

### 8.3 流程管理操作

#### 8.3.1 挂起流程实例

1. 在流程监控页面，找到要挂起的流程实例
2. 点击 **"挂起"** 按钮
3. 流程实例会被挂起，不再执行

**使用场景**：
- 流程出现异常需要暂停
- 需要人工介入处理

#### 8.3.2 激活流程实例

1. 在流程监控页面，找到已挂起的流程实例
2. 点击 **"激活"** 按钮
3. 流程实例恢复执行

---

## 9. 常见问题

### Q1: 为什么看不到"配置节点"按钮？

**A**: 确保流程定义已创建且未删除。如果流程定义不存在或已删除，无法配置节点。

### Q2: 部署流程时提示"节点配置不完整"？

**A**: 确保流程至少包含：
- 1个开始事件（startEvent）
- 1个用户任务（userTask）
- 1个结束事件（endEvent）

### Q3: 审批任务找不到？

**A**: 检查以下几点：
1. 流程是否已部署
2. 节点是否配置了审批人
3. 当前登录用户是否是配置的审批人
4. 任务是否已被其他审批人处理（候选审批人场景）

### Q4: 审批后流程没有流转到下一节点？

**A**: 检查以下几点：
1. 下一节点是否已配置
2. 下一节点的审批人是否配置正确
3. 查看流程监控，确认流程实例状态

### Q5: 如何查看流程的审批历史？

**A**: 进入"流程历史"页面，可以查看所有已完成的流程实例和审批记录。

### Q6: 可以修改已部署的流程吗？

**A**: 可以修改流程定义和节点配置，但需要重新部署。重新部署不会影响正在运行的流程实例。

### Q7: 如何删除流程定义？

**A**: 在流程定义列表中，点击"删除"按钮。注意：删除会同时删除所有节点配置，且操作不可恢复。

### Q8: 审批人如何配置多个用户？

**A**: 在节点配置中，审批人字段可以填写多个用户ID，用逗号分隔，例如：`1,2,3`。

### Q9: 候选审批人和候选审批组有什么区别？

**A**: 
- **候选审批人**: 指定具体的用户ID列表
- **候选审批组**: 指定角色ID，该角色的所有用户都可以审批

### Q10: 流程部署失败怎么办？

**A**: 
1. 检查节点配置是否完整
2. 检查节点ID是否重复
3. 检查审批人ID是否存在
4. 查看系统日志，查找具体错误信息

---

## 10. 最佳实践

### 10.1 流程设计建议

1. **流程名称要清晰**: 使用有意义的流程名称，便于识别
2. **流程Key要规范**: 使用英文，遵循命名规范
3. **节点名称要明确**: 每个审批节点的名称要清楚说明审批内容
4. **审批人配置要准确**: 确保审批人ID正确，避免任务找不到审批人

### 10.2 节点配置建议

1. **排序要连续**: 节点排序从0开始，连续递增
2. **开始事件排序为0**: 开始事件通常排序为0
3. **结束事件排序最大**: 结束事件通常排序最大
4. **审批节点按顺序**: 审批节点按审批顺序设置排序

### 10.3 审批流程建议

1. **申请理由要详细**: 填写详细的申请理由，便于审批人判断
2. **审批意见要明确**: 审批时填写明确的审批意见
3. **拒绝要说明原因**: 拒绝时务必填写拒绝原因

---

**文档版本**: v1.0  
**最后更新**: 2024-12-11

